version: 0.2

phases:
  install:
    runtime-versions:
      nodejs: 18
    commands:
      - echo "ğŸ” Current directory:"
      - pwd

      - echo "ğŸ“‚ Root directory listing:"
      - ls -al

      - echo "ğŸ“‚ Folder tree:"
      - find . -type d

      - echo "ğŸ“¦ Installing backend dependencies (app-tier)..."
      - if [ -d "app-tier" ]; then cd app-tier; else echo 'âŒ app-tier (backend) folder not found'; exit 1; fi
      - npm install

      - echo "ğŸ“¦ Installing frontend dependencies (web-tier)..."
      - if [ -d "../web-tier" ]; then cd ../web-tier; elif [ -d "web-tier" ]; then cd web-tier; else echo 'âŒ web-tier (frontend) folder not found'; exit 1; fi
      - npm install

  build:
    commands:
      - echo "âš™ï¸ Building frontend (web-tier)..."
      - if [ -d "../web-tier" ]; then cd ../web-tier; elif [ -d "web-tier" ]; then cd web-tier; else echo 'âŒ web-tier (frontend) folder not found for build'; exit 1; fi
      - npm run build
      - echo "âœ… Build complete."

artifacts:
  files:
    - appspec.yml
    - scripts/*
    - app-tier/**/*
    - web-tier/build/**/*
