version: 0.2

phases:
  install:
    runtime-versions:
      nodejs: 18
    commands:
      - echo "🔍 Current directory:"
      - pwd

      - echo "📂 Root directory listing:"
      - ls -al

      - echo "📂 Folder tree:"
      - find . -type d

      - echo "📦 Installing backend dependencies (app-tier)..."
      - if [ -d "app-tier" ]; then cd app-tier; else echo '❌ app-tier (backend) folder not found'; exit 1; fi
      - npm install

      - echo "📦 Installing frontend dependencies (web-tier)..."
      - if [ -d "../web-tier" ]; then cd ../web-tier; elif [ -d "web-tier" ]; then cd web-tier; else echo '❌ web-tier (frontend) folder not found'; exit 1; fi
      - npm install

  build:
    commands:
      - echo "⚙️ Building frontend (web-tier)..."
      - if [ -d "../web-tier" ]; then cd ../web-tier; elif [ -d "web-tier" ]; then cd web-tier; else echo '❌ web-tier (frontend) folder not found for build'; exit 1; fi
      - npm run build
      - echo "✅ Build complete."

artifacts:
  files:
    - appspec.yml
    - scripts/*
    - app-tier/**/*
    - web-tier/build/**/*
